# Zenly-Ghost-mode-attack

## 前言

本倉庫列舉了一種通過窮舉實現對Zenly APP幽靈模式的精確位置獲取方法。

## 什麼是Ghost（幽靈）模式👻

Zenly被開發為使用一種有趣的方式來聯繫和分享你的位置。但是，我們知道有時出於各種原因，你可能不想分享你的精確實時位置，這就是為什麼我們開發了Ghost（幽靈）模式，允許你自己決定誰看可以看到什麼！ Ghost模式可以分別對一個，一些或是所有你的朋友來設置。

**有三個選項可供選擇：**

1.  精確：顯示你的確切實時位置。
2.  模糊：顯示你所在區域的隨機位置。距離你的實際位置10米到1.2公里之間。
3.  凍結：在啟用凍結模式之後，你的位置將保持固定在你開啟凍結模式之前的最後位置。

開啟方法：在Zenly個人資料頁面，通過點擊位於頁面右上角的Ghost（幽靈）圖標，可以開啟Ghost模式設置界面。

## 原理

Zenly模糊定位算法每次都會將處於某坐標點的用戶做定向偏移，事實上，雖然這看起來十分隨機，可是如果你有兩個好友處於同一地點，並均開啟模糊定位，Zenly服務器會將他們兩個的坐標進行定向偏移，然後通過觀察，發現他們顯示為同一坐標位置，並且頭像重合。由此可知， 儘管Zenly的模糊定位屬於隨機移動，但是該隨機坐標並非按用戶區分移動，而是固定的隨機移動。

於是，可利用該特性，使用安卓模擬器並安裝Zenly，然後利用模擬器的虛擬GPS功能，在該好友模糊定位範圍內中的坐標進行遍歷，如果觀察到APP內頭像重疊，即可大致判斷出其精確位置。

## 手動攻擊

> 初始化

首先我們需要三個賬號來進行攻擊驗證，分別為 ：

-   A - 攻擊者
-   B - A的好友
-   C- 攻擊者的傀儡機器人

他們三個的關係為：

A作為攻擊者，需要獲取B的精確位置。

B為A的好友，同時B對A開啟了模糊定位。

C是A的傀儡，用於窮舉B的精確位置。同時A與C為好友關係，並且C對A也開啟了模糊定位，C與B不是好友。

> 驗證

A作為攻擊者，賬號將用於觀察B，C位置。由於B與C對A開啟了模糊位置，那麼我們需要先確認B的大致範圍。

假設B的位置不變，只需要移動C的坐標，若觀察到B與C位置重疊，即C的當前坐標為B的坐標。

Zenly的模糊範圍實際上是一個正方形，由於APP內顯示為圓形範圍，所以要取B當前坐標經緯值，加圓形外層一個點的經緯值，並以該距離為邊長繪製出一個正方形範圍。 （根據Zenly官方解釋，邊長應該是1200M。）

將改正方形平均劃分為9個區域，以每個區域中心點為目標修改9次C的坐標，找出9個點顯示與C距離最近的區域。

重複執行上述步直至B與C位置重合即判斷出C的坐標為B的坐標。

可以使用更多賬號來窮舉出B的位置，理論上賬號越多，速度越快，時間越短。

## 自動化攻擊（思路）

> 思路

利用安卓模擬器運行兩個實例，一個登錄攻擊者賬號（A），另外一個登錄機器人賬號（C）。

利用openCV與PyAutoGUI來觀察並控制實例A與C，獲取A的好友B的位置，通過安卓模擬器修改實例C的坐標，直到A觀察到B與C的位置重疊，最後打印出C的最後一次位置。

## 備註

> 修復

Zenly如果想解決模糊定位的問題，應該對隨機算法進行修改，如果檢測到大致處於同一坐標的用戶，應該對每個用戶進行不同的坐標偏移，而不是每次隨機偏移的位置一致。

該項目僅作為思路分享，沒有任何公開代碼，所有實驗賬號均為本人賬號。
